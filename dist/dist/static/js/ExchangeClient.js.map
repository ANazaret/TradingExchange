{"version":3,"sources":["../../../static/js/ExchangeClient.js"],"names":["_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","Constructor","protoProps","staticProps","prototype","_classCallCheck","instance","TypeError","ExchangeClient","exchange_id","product_id","book_depth","socket","io","connect","document","domain","location","port","order_book","OrderBook","order_history","OrderHistory","bindSockets","bindEvents","value","bookUpdate","data","update","orderUpdate","$","append","emit","initExchangeData","bind","_this","forEach","order","scrollDown","self","on","undefined","click","eventPlaceOrder","event","side","originalEvent","attributes","price","parseFloat","val","volume","parseInt","placeOrder","_this2","cancelOrder","order_id","status"],"mappings":"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","file":"ExchangeClient.js","sourcesContent":["'use strict';\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar ExchangeClient = function () {\n    function ExchangeClient(exchange_id, product_id, book_depth) {\n        _classCallCheck(this, ExchangeClient);\n\n        this.exchange_id = exchange_id;\n        this.product_id = product_id;\n        this.book_depth = book_depth;\n        this.socket = io.connect('http://' + document.domain + ':' + location.port);\n        this.order_book = new OrderBook('#order_book', this.book_depth);\n        this.order_history = new OrderHistory(\"#order_history\", this);\n        this.bindSockets();\n        this.bindEvents();\n    }\n\n    _createClass(ExchangeClient, [{\n        key: 'bookUpdate',\n        value: function bookUpdate(data) {\n            this.order_book.update(data['order_book']);\n        }\n    }, {\n        key: 'orderUpdate',\n        value: function orderUpdate(data) {\n            this.order_history.update(data);\n        }\n    }, {\n        key: 'connect',\n        value: function connect() {\n            $('#exchange-name').append('Â <span class=\"glyphicon glyphicon-ok\"></span>');\n            this.socket.emit('join_exchange', { 'exchange_id': this.exchange_id, 'product_id': this.exchange_id + '__default' }, this.initExchangeData.bind(this));\n        }\n    }, {\n        key: 'initExchangeData',\n        value: function initExchangeData(data) {\n            var _this = this;\n\n            this.order_book.update(data['order_book']);\n            data['user_orders'].forEach(function (order) {\n                return _this.order_history.update(order, true);\n            });\n            this.order_history.scrollDown();\n        }\n    }, {\n        key: 'bindSockets',\n        value: function bindSockets() {\n            var self = this;\n            this.socket.on('connect', function () {\n                return self.socket.emit('connected', self.connect.bind(self));\n            });\n            this.socket.on('exchange_update', function () {\n                return undefined;\n            });\n            this.socket.on('order_update', self.orderUpdate.bind(self));\n            this.socket.on('book_update', self.bookUpdate.bind(self));\n        }\n    }, {\n        key: 'bindEvents',\n        value: function bindEvents() {\n            var self = this;\n            $('.btn-send-order').click(self.eventPlaceOrder.bind(self));\n        }\n    }, {\n        key: 'eventPlaceOrder',\n        value: function eventPlaceOrder(event) {\n            var side = event.originalEvent.target.attributes['data-side'].value;\n            var price = parseFloat($('#price').val());\n            var volume = parseInt($('#volume').val());\n            if (price > 0 && volume > 0) {\n                this.placeOrder(side, price, volume);\n            }\n        }\n    }, {\n        key: 'placeOrder',\n        value: function placeOrder(side, price, volume) {\n            var _this2 = this;\n\n            this.socket.emit('place_order', {\n                'side': side,\n                'price': price,\n                'volume': volume,\n                'product_id': this.product_id\n            }, function (order) {\n                return _this2.orderUpdate.bind(_this2)(order);\n            });\n        }\n    }, {\n        key: 'cancelOrder',\n        value: function cancelOrder(order_id, product_id) {\n            this.socket.emit('cancel_order', {\n                'product_id': product_id,\n                'order_id': order_id\n            });\n        }\n    }], [{\n        key: 'orderUpdate',\n        value: function orderUpdate(order) {\n            $('#exchange').append(order.order_id + \" \" + order.status);\n        }\n    }]);\n\n    return ExchangeClient;\n}();\n//# sourceMappingURL=ExchangeClient.js.map"]}